<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Dashboard Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="dashboard-sidebar">
            <div class="search-panel">
                <h3><i class="fas fa-search-location"></i> Location Search</h3>
                <input type="text" class="input-field" placeholder="Enter location">
                <button class="search-button"><i class="fas fa-search"></i> Search</button>
            </div>
        </aside>
        
        <main class="dashboard-main">
            <div class="map-container">
                <button id="show-my-location" class="location-btn">
                    <i class="fas fa-location-arrow"></i>
                    <span>আমার অবস্থান</span>
                </button>
                <div class="map-info-overlay">
                    <h4><i class="fas fa-map-marker-alt"></i> Service Providers</h4>
                    <p>Find service providers around you</p>
                </div>
                <div id="mapid"></div>
            </div>
        </main>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        var map = L.map('mapid', {
            center: [23.8103, 90.4125], 
            zoom: 15,  
            maxZoom: 21,
            minZoom: 5,
            zoomControl: false
        });
        
        L.control.zoom({
            position: 'bottomright' 
        }).addTo(map);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 22  
        }).addTo(map);
        
        // Global variables
        let userLocation = [23.8103, 90.4125];
        let userMarker = null;
        
        // Enhanced user location setter with pulsing animation
        function setUserLocationWithPulse(lat, lng) {
            userLocation = [lat, lng];
            map.setView(userLocation, 16);
            
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            // Create pulsing user marker
            userMarker = L.marker(userLocation, {
                icon: L.divIcon({
                    html: '<div style="width:20px;height:20px;background:#00C6FF;border-radius:50%;animation:pulse 2s infinite;"></div>',
                    iconSize: [20, 20],
                    className: 'user-location-container'
                })
            }).addTo(map).bindPopup('আপনার বর্তমান অবস্থান').openPopup();
        }
        
        // Initialize location button functionality
        function initializeLocationButton() {
            const locationBtn = document.getElementById('show-my-location');
            
            if (locationBtn) {
                locationBtn.addEventListener('click', function() {
                    // Add loading state
                    locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>অবস্থান খোঁজা হচ্ছে...</span>';
                    locationBtn.disabled = true;
                      
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                const lat = position.coords.latitude;
                                const lng = position.coords.longitude;
                                  
                                // Set user location with pulsing marker
                                setUserLocationWithPulse(lat, lng);
                                
                                // Reset button
                                locationBtn.innerHTML = '<i class="fas fa-location-arrow"></i><span>আমার অবস্থান</span>';
                                locationBtn.disabled = false;
                            },
                            function(error) {
                                // Reset button
                                locationBtn.innerHTML = '<i class="fas fa-location-arrow"></i><span>আমার অবস্থান</span>';
                                locationBtn.disabled = false;
                            },
                            {
                                enableHighAccuracy: true,
                                timeout: 10000,
                                maximumAge: 60000
                            }
                        );
                    } else {
                        locationBtn.innerHTML = '<i class="fas fa-location-arrow"></i><span>আমার অবস্থান</span>';
                        locationBtn.disabled = false;
                    }
                });
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeLocationButton();
            });
        } else {
            initializeLocationButton();
        }
        
        // Backup initialization
        window.addEventListener('load', function() {
            const locationBtn = document.getElementById('show-my-location');
            if (locationBtn && !locationBtn.hasAttribute('data-initialized')) {
                initializeLocationButton();
                locationBtn.setAttribute('data-initialized', 'true');
            }
        });
    </script>
</body>
</html>
